require('dotenv').config();

const { VK, Keyboard } = require('vk-io');

const { handleWebhook } = require('../handleWebhook');

vk.updates.on('message_new', async (context) => {
         // –ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ context
    const userName = context.senderId ? await getUserName(context.senderId) : '–¥—Ä—É–≥';

    // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏
    if (context.text === '/start') {
        await context.send({
            message: `${userName}, –ø–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –≤–∞—Å —Å –≤—ã–±–æ—Ä–æ–º —ç–∫—Å–∫—É—Ä—Å–∏–∏! üöÄ\n\n` +
                     '–ß—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ.\n\n' +
                     '–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∫–∞–∫–∏–µ-–ª–∏–±–æ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ–±—Å—É–¥–∏—Ç—å –¥–µ—Ç–∞–ª–∏, –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –Ω–∞–º. –ú—ã —Ä–∞–¥—ã –ø–æ–º–æ—á—å! üòâ',
            keyboard: {
                one_time: false,
                buttons: [
                    [Button.green({ label: '–£—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ' })],
                    [Button.blue({ label: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —ç–∫—Å–∫—É—Ä—Å–∏–∏' }), Button.red({ label: 'üìÖ –î–∞—Ç—ã —ç–∫—Å–∫—É—Ä—Å–∏–π' })],
                ],
            },
        });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É "–î–∞—Ç—ã —ç–∫—Å–∫—É—Ä—Å–∏–π"
    if (context.text === 'üìÖ –î–∞—Ç—ã —ç–∫—Å–∫—É—Ä—Å–∏–π') {
        await context.send({
            message: 'üóìÔ∏è –î–∞—Ç—ã —ç–∫—Å–∫—É—Ä—Å–∏–π.\n\n' +
                     '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–¥–µ—Å—å‚Üì\n' +
                     '–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å—Å—ã–ª–∫–∞ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞—Ç—ã –ø–æ–µ–∑–¥–æ–∫.\n\n' +
                     '–ï—Å–ª–∏ —Å—Å—ã–ª–∫–∏ –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ –Ω–µ—Ç, –Ω–∞–ø–∏—à–∏—Ç–µ –∂–µ–ª–∞–µ–º—É—é –¥–∞—Ç—É —Ç—É—Ä–∞ –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏.\n\n' +
                     '–ï—Å–ª–∏ –≤–∞—à–∞ –≥—Ä—É–ø–ø–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 4 —á–µ–ª–æ–≤–µ–∫ –∏–ª–∏ –±–æ–ª—å—à–µ, –≤—ã —Å–º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å –ª—é–±—É—é —É–¥–æ–±–Ω—É—é –¥–∞—Ç—É —Ç—É—Ä–∞ –∏ –ø—É—Ç–µ—à–µ—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–µ–π –∫–æ–º–ø–∞–Ω–∏–µ–π.',
            keyboard: {
                one_time: false,
                buttons: [
                    [Button.blue({ label: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —ç–∫—Å–∫—É—Ä—Å–∏–∏' })],
                    [Button.green({ label: '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å' })],
                    [Button.white({ label: '–ù–∞–∑–∞–¥' })],
                ],
            },
        });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å"
    if (context.text === '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å') {
        await context.send({
            message: '–°–ø–∞—Å–∏–±–æ, –≤–∞—à–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ –±—Ä–æ–Ω—å —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–Ω—è—Ç–∞!ü§ù\n\n' +
                     '–°–∫–æ—Ä–æ —Å –≤–∞–º–∏ —Å–≤—è–∂–µ—Ç—Å—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É—Ç–æ—á–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –¥–µ—Ç–∞–ª–µ–π. –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∫–∞–∫–∏–µ-–ª–∏–±–æ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –Ω–∞–º. –î–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –æ—Ç–≤–µ—Ç–æ–º –Ω–∞ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ :\n\n' +
                     '1. –ñ–µ–ª–∞–µ–º—É—é –¥–∞—Ç—É —Ç—É—Ä–∞ (–ª–∏–±–æ –¥–∞—Ç—É –ø—Ä–∏–µ–∑–¥–∞)\n' +
                     '2. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–ª–æ–≤–µ–∫ (–ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ, –µ—Å–ª–∏ —Å –≤–∞–º–∏ –µ–¥—É—Ç –¥–µ—Ç–∏ - –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –≤–æ–∑—Ä–∞—Å—Ç)\n\n' +
                     '–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –ø–æ–¥–æ–±—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è.\n\n' +
                     '–°–æ–≤–µ—Ç—É–µ–º –ø–æ—á–∏—Ç–∞—Ç—å —Ä–∞–∑–¥–µ–ª "‚ùì–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã"\n\n' +
                     '–ú—ã –∂–µ–ª–∞–µ–º –≤–∞–º –Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã—Ö –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–π –≤ –≤–∞—à–µ–º –ø—Ä–µ–¥—Å—Ç–æ—è—â–µ–º –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–∏!\n\n' +
                     '–° —É–≤–∞–∂–µ–Ω–∏–µ–º,\n' +
                     '–î–∞–≥–µ—Å—Ç–∞–Ω—Å–∫–∏–π –û—Ä–µ–ª –¢—É—Äü¶Ö\n' +
                     '8(999)981-78-89',
            keyboard: {
                one_time: false,
                buttons: [
                    [Button.white({ label: '–ù–∞–∑–∞–¥' })],
                    [Button.blue({ label: '–ú–µ–Ω—é' })],
                    [Button.red({ label: '–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã FAQ' })],
                ],
            },
        });
    }

    // –î—Ä—É–≥–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–£—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ", "–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å", –∏ —Ç.–¥.) –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∑–¥–µ—Å—å...

});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –µ–≥–æ ID
async function getUserName(userId) {
    const user = await vk.api.users.get({ user_ids: userId });
    return user[0].first_name; // –∏–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å full_name, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–ª–Ω–æ–µ –∏–º—è
}

// –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
vk.updates.start().catch(console.error);

